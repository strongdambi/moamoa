{% extends 'webs/base.html' %}

{% load static %}

{% block title %}모아모아 - 오늘의 용돈기입장{% endblock %}

{% block content %}
<div class="container">
  <!-- Greeting -->
  <div class="greeting">
    <p id="child-greeting">아이의 이름을 불러옵니다...</p>
  </div>

  <!-- Spending Log Table -->
  <div class="log-table">
    <h5 class="text-center">오늘의 용돈기입장</h5>
    <table class="table table-borderless">
      <thead>
        <tr>
          <th>내용</th>
          <th>쓴 돈</th>
          <th>받은 돈</th>
          <th>남은 돈</th>
        </tr>
      </thead>
      <tbody id="diary-table-body">
        <!-- 용돈기입장 항목들이 여기에 추가됩니다 -->
      </tbody>
    </table>
  </div>

  <!-- Encouragement Message -->
  <div class="encouragement">
    <p>모아모아의 응원!</p>
    <p>오늘도 용돈기입장에 기록했구나 정말 잘했어.<br>앞으로도 멋지게 용돈을 관리해보자. 화이팅!</p>
  </div>

  <!-- Badge -->
  <div class="badge">
    아이스크림 헌터
  </div>
</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
  <a href="#">
    <img src="your-home-icon-url" alt="Home">
  </a>
  <a href="#">
    <img src="your-calendar-icon-url" alt="Calendar">
  </a>
  <a href="#">
    <img src="your-add-icon-url" alt="Add" style="width: 50px; height: 50px;">
  </a>
  <a href="#">
    <img src="your-bell-icon-url" alt="Notifications">
  </a>
  <a href="#">
    <img src="your-profile-icon-url" alt="Profile">
  </a>
</div>
{% endblock %}

{% block extra_script %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    // URL에서 자녀 ID 추출하기
    const childId = window.location.pathname.split("/")[3];  // URL에서 자녀 ID 추출
    const year = new Date().getFullYear();
    const month = new Date().getMonth() + 1;

    // 자녀 정보 가져오기
    fetch(`http://localhost:8000/api/v1/accounts/children/${childId}/`, {
        method: 'GET',
        credentials: 'include',
        headers: {
            'Content-Type': 'application/json',
        },
    })
    .then((response) => response.json())
    .then((data) => {
        const greeting = document.getElementById('child-greeting');
        greeting.textContent = `${data.first_name} 반가워!`;  // 자녀 이름 표시
    })
    .catch((error) => {
        console.error('프로필을 불러올 수 없습니다.:', error);
    });

    // 월별 용돈기입장 가져오기
    fetch(`http://localhost:8000/api/v1/diary/${childId}/${year}/${month}/`, {
        method: 'GET',
        credentials: 'include',
        headers: {
            'Content-Type': 'application/json',
        },
    })
    .then((response) => response.json())
    .then((data) => {
        const diaryTableBody = document.getElementById('diary-table-body');
        diaryTableBody.innerHTML = '';  // 테이블 초기화
        data.diary.forEach((entry) => {
            const row = `
            <tr>
                <td>${entry.description}</td>
                <td>${entry.spent_amount}원</td>
                <td>${entry.received_amount}원</td>
                <td>${entry.remaining_amount}원</td>
            </tr>`;
            diaryTableBody.insertAdjacentHTML('beforeend', row);
        });
    })
    .catch((error) => {
        console.error('용돈기입장을 불러올 수 없습니다.', error);
    });
});
  </script>
{% endblock %}